######################
### Global Section ###
######################
# Names this node should listen on. Note that you will have to configure a
# host_config section, before you can actually use a new server.
hosts: 
  - "jabber.at"
  - "jabber.fsinf.at"
  - "fsinf.at"
  - "anon.jabber.at"
  - "jabber.wien"
  - "jabber.zone"
  - "xmpp.zone"

# only one registration per hour per IP:
language: "en"
auth_method: internal
auth_password_format: scram
registration_timeout: 3600
captcha_cmd: "/usr/share/ejabberd/captcha.sh"
captcha_host: "https://jabber.at:443"
shaper: 
  normal: 20000
  proxy: 50000
  fast: 50000

# logging
loglevel: 4
log_rotate_date: ""
log_rotate_size: 0
hide_sensitive_log_data: true

# Disabling digest-md5 SASL mechanism to see what happens when we enable SCRAM
# password hashing.
disable_sasl_mechanisms: 
    - "digest-md5"
    - "x-oauth2"

# The default ciphers-setting is found here:
#    https://github.com/processone/tls/blob/master/c_src/p1_tls_drv.c
# We use the default and exclude a few additional ciphers classified as weak
# by xmpp.net.
define_macro:
  'TLS_OPTIONS':
    - "no_sslv2"
    - "no_sslv3"
  'TLS_CIPHERS': "ECDH:DH:!CAMELLIA128:!3DES:!MD5:!RC4:!aNULL:!NULL:!EXPORT:!LOW:!MEDIUM"
  'TRANSPORTS':
    - "icq.jabber.at"
  'MOD_MUC_OPTIONS':
        access: everybody
        access_create: local
        access_admin: muc_admin
        min_message_interval: 1
        min_presence_interval: 5
        default_room_options:
          moderated: false
          members_by_default: false
  'MOD_MUC_LOG_OPTIONS':
    access_log: everybody
    timezone: local
    # TODO 1: outdir is very old left-over from old drupal on same host.
    # TODO 2: Is it possible to have @HOST@ here? If no, maybe bugreport?
    outdir: "/var/www/jabber.at/sites/jabber.at/logs/"
    file_permissions:
      mode: 644
      group: 33
    spam_prevention: true
  'API_COMMANDS':
    - change_password
    - check_account
    - check_password
    - get_last
    - register
    - registered_users
    - send_message
    - set_last
    - stats
    - stats_host
    - unregister

#####################
### Include files ###
#####################
include_config_file:
  "/etc/ejabberd/secrets.yml": []
  "/etc/ejabberd/acl.yml": []
  "/etc/ejabberd/access.yml": []
#  "/etc/ejabberd/blocked.yml": []
  "/etc/ejabberd/ports.yml": []
  "/etc/ejabberd/modules.yml": []
commands_admin_access: xmlrpc
commands: 'API_COMMANDS'

##########################
### Host configuration ###
##########################
host_config: 
  "jabber.at":
    domain_certfile: 'CERT_LOCATION_JABBER_AT'
    acl: 
      admin: 
        user: 
          - "ra": "jabber.at"
          - "klausi": "jabber.at"
    sql_type: 'SQL_TYPE'
    sql_server: 'SQL_SERVER'
    sql_port: 'SQL_PORT'
    sql_database: 'SQL_DB_JABBER_AT'
    sql_username: 'SQL_USER_JABBER_AT'
    sql_password: 'SQL_PASS_JABBER_AT'

  "anon.jabber.at":
    domain_certfile: 'CERT_LOCATION_JABBER_AT'
    auth_method: [anonymous]
    anonymous_protocol: both

  "jabber.fsinf.at":
    domain_certfile: 'CERT_LOCATION_JABBER_FSINF_AT'
    sql_type: 'SQL_TYPE'
    sql_server: 'SQL_SERVER'
    sql_port: 'SQL_PORT'
    sql_database: 'SQL_DB_JABBER_FSINF_AT'
    sql_username: 'SQL_USER_JABBER_FSINF_AT'
    sql_password: 'SQL_PASS_JABBER_FSINF_AT'
  "fsinf.at": 
    domain_certfile: 'CERT_LOCATION_FSINF_AT'
    sql_type: 'SQL_TYPE'
    sql_server: 'SQL_SERVER'
    sql_port: 'SQL_PORT'
    sql_database: 'SQL_DB_FSINF_AT'
    sql_username: 'SQL_USER_FSINF_AT'
    sql_password: 'SQL_PASS_FSINF_AT'
  "jabber.zone":
    domain_certfile: 'CERT_LOCATION_JABBER_ZONE'
    sql_type: 'SQL_TYPE'
    sql_server: 'SQL_SERVER'
    sql_port: 'SQL_PORT'
    sql_database: 'SQL_DB_JABBER_ZONE'
    sql_username: 'SQL_USER_JABBER_ZONE'
    sql_password: 'SQL_PASS_JABBER_ZONE'
  "jabber.wien":
    domain_certfile: 'CERT_LOCATION_JABBER_WIEN'
    sql_type: 'SQL_TYPE'
    sql_server: 'SQL_SERVER'
    sql_port: 'SQL_PORT'
    sql_database: 'SQL_DB_JABBER_WIEN'
    sql_username: 'SQL_USER_JABBER_WIEN'
    sql_password: 'SQL_PASS_JABBER_WIEN'
  "xmpp.zone":
    domain_certfile: 'CERT_LOCATION_XMPP_ZONE'
    sql_type: 'SQL_TYPE'
    sql_server: 'SQL_SERVER'
    sql_port: 'SQL_PORT'
    sql_database: 'SQL_DB_XMPP_ZONE'
    sql_username: 'SQL_USER_XMPP_ZONE'
    sql_password: 'SQL_PASS_XMPP_ZONE'
